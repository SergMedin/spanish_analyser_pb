#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö 8-–±–∏—Ç–Ω—ã—Ö –º–µ–ª–æ–¥–∏–π –≤ —á–∏–ø—Ç—é–Ω-–ø–ª–µ–µ—Ä–µ.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    python test_chiptunes.py [–∏–º—è_–ø—Ä–µ—Å–µ—Ç–∞]

–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:
- nokia_classic (–Ω–æ–≤—ã–π Nokia —Ä–∏–Ω–≥—Ç–æ–Ω)
- tetris_theme (–º–µ–ª–æ–¥–∏—è –¢–µ—Ç—Ä–∏—Å–∞)
- mario_theme (Super Mario Bros)
- simple_mobile (–ø—Ä–æ—Å—Ç–∞—è –º–æ–±–∏–ª—å–Ω–∞—è –º–µ–ª–æ–¥–∏—è)
- boomer_mobile (–∞–ª–∏–∞—Å –¥–ª—è simple_mobile)
- cambio_groove (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π)
- neo_pulse (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π)
- ambient_chips (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π)
"""

import sys
import time
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –º–æ–¥—É–ª—é
sys.path.insert(0, str(Path(__file__).parent.parent.parent / "src"))

try:
    from spanish_analyser.tools.chiptune_player import ChiptunePlayer, PRESETS
except ImportError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
    print("üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏")
    sys.exit(1)


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏–ø—Ç—é–Ω-–º–µ–ª–æ–¥–∏–π."""
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–µ—Å–µ—Ç –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
    preset_name = sys.argv[1] if len(sys.argv) > 1 else "nokia_classic"
    
    if preset_name not in PRESETS:
        print(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ—Å–µ—Ç: {preset_name}")
        print(f"üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã: {', '.join(PRESETS.keys())}")
        sys.exit(1)
    
    print(f"üéµ –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–µ–ª–æ–¥–∏—é: {preset_name}")
    print(f"üìù –î–ª–∏–Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞: {len(PRESETS[preset_name])} –Ω–æ—Ç")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ—Ç –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
    notes = PRESETS[preset_name][:16]
    print(f"üéº –ü–µ—Ä–≤—ã–µ 16 –Ω–æ—Ç: {notes}")
    
    # –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–ª–µ–µ—Ä
    player = ChiptunePlayer()
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ—Å–µ—Ç —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–∏–º—É–ª–∏—Ä—É–µ–º)
    import os
    os.environ["SPANISH_ANALYSER_CHIPTUNE_PRESET"] = preset_name
    os.environ["SPANISH_ANALYSER_CHIPTUNE_TEMPO"] = "0.15"  # –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è
    os.environ["SPANISH_ANALYSER_CHIPTUNE_AMP"] = "0.2"     # —Ç–∏—à–µ
    
    print("üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–µ–µ—Ä...")
    
    if player.start():
        print(f"‚úÖ –ü–ª–µ–µ—Ä –∑–∞–ø—É—â–µ–Ω! –ò–≥—Ä–∞–µ—Ç –º–µ–ª–æ–¥–∏—è '{preset_name}'")
        print("‚èπÔ∏è  –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
        
        try:
            # –ò–≥—Ä–∞–µ–º 30 —Å–µ–∫—É–Ω–¥
            for i in range(30):
                time.sleep(1)
                print(f"‚è±Ô∏è  {i+1}/30 —Å–µ–∫", end="\r")
        except KeyboardInterrupt:
            print("\nüõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
        
        print("\nüîá –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–µ–µ—Ä...")
        player.stop()
        print("‚úÖ –ü–ª–µ–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–µ–µ—Ä")
        print("üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
        print("   - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ numpy/sounddevice")
        print("   - –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∞—É–¥–∏–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞")
        print("   - –ü—Ä–æ–±–ª–µ–º—ã —Å –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏ –∑–≤—É–∫–∞")


if __name__ == "__main__":
    main()
